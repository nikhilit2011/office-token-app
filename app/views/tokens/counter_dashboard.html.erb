<div class="container">
  <h2 class="mb-4 text-center">Counter Dashboard – <%= current_user.assigned_counter %></h2>

  <table class="table table-bordered table-striped">
    <thead class="table-light">
      <tr>
        <th>Token #</th>
        <th>Applicant</th>
        <th>Vehicle</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="counter-dashboard-body">
      <%= render partial: "tokens/dashboard_rows", locals: { tokens: @tokens } %>
    </tbody>
  </table>

  <!-- ✅ Correct audio path to audios/new_token_generated.mp3 -->
  <audio id="token-alert" src="<%= asset_path('new_token_generated.mp3') %>" preload="auto"></audio>
</div>

<script>
  let lastTokenId = null;

  function refreshCounterDashboard() {
    fetch("/tokens/refresh_counter_dashboard")
      .then(response => response.text())
      .then(html => {
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = html;
        const newRows = tempDiv.querySelectorAll("tr");
        const newTokenId = newRows[0]?.dataset.tokenId;

        if (lastTokenId && newTokenId && newTokenId !== lastTokenId) {
          document.getElementById("token-alert").play();
        }

        lastTokenId = newTokenId;
        document.getElementById("counter-dashboard-body").innerHTML = tempDiv.innerHTML;
      });
  }

  setInterval(refreshCounterDashboard, 5000);
</script>
