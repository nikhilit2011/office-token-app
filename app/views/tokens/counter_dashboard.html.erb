<div class="container">
  <h2 class="mb-4 text-center">Counter Dashboard â€“ <%= current_user.assigned_counter %></h2>

  <table class="table table-bordered table-striped">
    <thead class="table-light">
      <tr>
        <th>Token #</th>
        <th>Applicant</th>
        <th>Vehicle</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="counter-dashboard-body">
      <%= render partial: "tokens/dashboard_rows", locals: { tokens: @tokens } %>
    </tbody>
  </table>

  <div id="pagination-links" class="text-center mt-3">
    <%= paginate @tokens, remote: true %>
  </div>
</div>

<script>
  let lastTokenId = null;

  function refreshCounterDashboard() {
    const currentPage = new URLSearchParams(window.location.search).get('page') || 1;

    fetch(`/tokens/refresh_counter_dashboard?page=${currentPage}`)
      .then(response => response.text())
      .then(html => {
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = html;

        const newRows = tempDiv.querySelectorAll("tr");
        const tbody = document.getElementById("counter-dashboard-body");

        // Clear old rows
        tbody.innerHTML = "";

        // Append each row individually to preserve spacing and styles
        newRows.forEach(row => tbody.appendChild(row));

        const newTokenId = newRows[0]?.dataset.tokenId;
        if (lastTokenId && newTokenId && newTokenId !== lastTokenId) {
          // sound alert removed
        }

        lastTokenId = newTokenId;
      });
  }

  setInterval(refreshCounterDashboard, 5000);
</script>

